# âš™ï¸ Ansible ì¡°ê±´ë¬¸ (when)

## ğŸ“Œ ê°œìš”

- Ansibleì—ì„œëŠ” `when` ì¡°ê±´ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ **íŠ¹ì • ì¡°ê±´ì´ ì°¸ì¼ ë•Œë§Œ ì‘ì—…(task)ì´ë‚˜ í”Œë ˆì´(play)ë¥¼ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì¡°ê±´ë¬¸ì„ í™œìš©í•˜ë©´ ìš´ì˜ì²´ì œ ì¢…ë¥˜, ë³€ìˆ˜ ê°’, Ansible íŒ©íŠ¸ ë“±ì— ë”°ë¼ **ìœ ì—°í•œ ì‘ì—… ì œì–´**ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## ğŸ›  ì¡°ê±´ë¬¸ ì‘ì„± ë°©ì‹

```yaml
- name: Install Nginx on CentOS only
  yum:
    name: nginx
    state: present
  when: ansible_facts.distribution == "CentOS"
```

---

## âœ… ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¡°ê±´ ìš”ì†Œ

- **í”Œë ˆì´ ë³€ìˆ˜**
- **ì‘ì—… ë³€ìˆ˜**
- **Ansible íŒ©íŠ¸ (`ansible_facts.*`)**
- **Boolean ê°’**

---

### ì¡°ê±´ ì‘ì—… êµ¬ë¬¸

ê°œìš”


- 'when ë¬¸'ì€ ì¡°ê±´ë¶€ë¡œ ì‘ì—…ì„ ì‹¤í–‰í•  ë•Œ í…ŒìŠ¤íŠ¸í•  ì¡°ê±´ì„ ê°’ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.


- ì¡°ê±´ì´ ì¶©ì¡±ë˜ë©´ ì‘ì—…ì´ ì‹¤í–‰ë˜ê³ . ì¡°ê±´ì´ ì¶©ì¡±ë˜ì§€ ì•Šìœ¼ë©´ ì‘ì—…ì„ ê±´ë„ˆë›´ë‹¤.


- 'when ë¬¸'ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•œ ì¡°ê±´ ì¤‘ í•˜ë‚˜ëŠ” 'Boolean ë³€ìˆ˜'ê°€ 'true'ì¸ì§€ 'false'ì¸ì§€ì˜ ì—¬ë¶€ì´ë‹¤.

### Step 1. 'Boolean ëŒ€ìˆ˜'ë¥¼ ì´ìš©í•œ 'when'ë¬¸ì´ ë™ì‘ë˜ëŠ” íŒŒì¼ ìƒì„±

#### /root/my-ansible/when_task.yml
```
---

- hosts: localhost
  vars:
    run_my_task: true


  tasks:
    - name: echo message
      ansible.builtin.shell: "echo test"
      when: run_my_task
```
### Step 2. í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250522/0025.png)

### Step 3.'Boolean ëŒ€ìˆ˜'ë¥¼ ì´ìš©í•œ 'when'ë¬¸ì´ ë™ì‘ë˜ëŠ” íŒŒì¼ ìˆ˜ì •

#### /root/my-ansible/when_task.yml
```
---

- hosts: localhost
  vars:
    run_my_task: false


  tasks:
    - name: echo message
      ansible.builtin.shell: "echo test"
      when: run_my_task
```

### Step 4. í”Œë ˆì´ë¶ ì‹¤í–‰ 2

![](./img/20250522/0026.png)


# ì¡°ê±´ ì—°ì‚°ì

## ê°œìš”
: OS ì¢…ë¥˜ì— ë”°ë¼ ë°ìŠ¤í¬ë¥¼ ìˆ˜í–‰í•œë‹¤.

### Step 1. 'vars' í‚¤ì›Œë“œë¥¼ ì´ìš©í•œ ë³€ìˆ˜ë¥¼ ì‚¬ì „ íƒ€ì…ì˜ ê°’ìœ¼ë¡œ ì €ì¥í•˜ê³  ì¡°ê±´ë¬¸ì„ ì¶”ê°€
#### /root/my-ansible/check-os.yml
```
---

- hosts: all
  vars:
    supported_distros:
      - RedHat
      - CentOS


  tasks:
    - name: Print supported os
      ansible.builtin.debug:
        msg: "This {{ ansible_facts['distribution'] }} need to use dnf"
      when: ansible_facts['distribution'] in supported_distros
```
### í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250522/0027.png)


# ë³µìˆ˜ ì¡°ê±´ë¬¸(ë‹¤ì¤‘ ì¡°ê±´ë¬¸)

## ê°œìš”
- ì¡°ê±´ë¬¸ì•ˆì— ë˜ë‹¤ë¥¸ ì¡°ê±´ë¬¸ì´ í¬í•¨ëœ í˜•íƒœ

### Step 1. íŒŒì¼ ë³µì‚¬ í›„ ìˆ˜ì • 1. OR

#### /root/my-ansible/check-os1.yml
```
---

- hosts: all


  tasks:
    - name: Print os type
      ansible.builtin.debug:
        msg: "OS Type: {{ ansible_facts['distribution'] }}"
      when: ansible_facts['distribution'] == "Rocky" or ansible_facts['distribution'] == "Ubuntu"
```
### Step 2. í”Œë ˆì´ë¶ ì‹¤í–‰
![](./img/20250523/0001.png)

### Step 3. íŒŒì¼ ë³µì‚¬ í›„ ìˆ˜ì • 2. and

#### /root/my-ansible/check-os2.yml

```
---

- hosts: all


  tasks:
    - name: Print os type
      ansible.builtin.debug:
        msg: >
             OS Type: {{ ansible_facts['distribution'] }}
             OS Version: {{ ansible_facts['distribution_version'] }}
      when: ansible_facts['distribution'] == "CentOS" and ansible_facts['distribution'] == "8"
```

### ë²ˆì™¸ OR

```
---

- hosts: all


  tasks:
    - name: Print os type
      ansible.builtin.debug:
        msg: >
             OS Type: {{ ansible_facts['distribution'] }}
             OS Version: {{ ansible_facts['distribution_version'] }}
      when: ansible_facts['distribution'] == "Rocky" or ansible_facts['distribution'] == "8"
```

### Step 4. í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250523/0002.png)



### Step 5. íŒŒì¼ ìˆ˜ì •, ì‚¬ì „ ì´ìš©
#### /root/my-ansible/check-os3.yml
```
---

- hosts: all


  tasks:
    - name: Print os type
      ansible.builtin.debug:
        msg: >
             OS Type: {{ ansible_facts['distribution'] }}
             OS Version: {{ ansible_facts['distribution_version'] }}
      when:
        - ansible_facts['distribution'] == "Rocky"
        - ansible_facts['distribution_version'] == "8.10"
```

### Step 6. í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250523/0003.png)

### Step 7. íŒŒì¼ìˆ˜ì •

#### /root/my-ansible/check-os4.yml

```
---

- hosts: all


  tasks:
    - name: Print os type
      ansible.builtin.debug:
        msg: >
             OS Type: {{ ansible_facts['distribution'] }}
             OS Version: {{ ansible_facts['distribution_version'] }}
      when: >
          ( ansible_facts['distribution'] == "Rocky" and
            ansible_facts['distribution_version'] == "8.10" )
          or
          ( ansible_facts['distribution'] == "Ubunut" and
            ansible_facts['distribution_version'] == "24.04" )
```

### Step 8. í”Œë ˆì´ë¶ ì‹¤í–‰
![](./img/20250523/0004.png)


# ë°˜ë³µë¬¸ê³¼ ì¡°ê±´ë¬¸

## ê°œìš”

### Step 1. íŒŒí‹°ì…˜ ìš©ëŸ‰
#### /root/my-ansible/check-mount
```
---

- hosts: db


  tasks:
    - name: Print Root Directory Size
      ansible.builtin.debug:
        msg: "Directory {{ item.mount }} size is {{ item.size_available }}"
      loop: "{{ ansible_facts['mounts'] }}"
      when: item['mount'] == "/" and item['size_available'] > 300000000
```

### Step 2. í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250523/0005.png)

### Step 3. 'register' í‚¤ì›Œë“œë¥¼ ì´ìš©í•œ ì‘ì—…ë³€ìˆ˜
#### /root/my-ansible/register-when.yml
```
---

- hosts: all

  tasks:
    - name: Get rsyslog service status
      ansible.builtin.command: systemctl is-active rsyslog
      register: result


    - name: Print rsyslog status
      ansible.builtin.debug:
        msg: "Rsyslog status is {{ result.stdout }}"
      when: result.stdout == "active"
```
### Step 4. í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250523/0006.png)