# π” Ansible Vault

## π“ κ°μ”

- Ansibleμ„ μ‚¬μ©ν•  λ• **ν¨μ¤μ›λ“**, **API ν‚¤** λ“± λ―Όκ°ν• μ •λ³΄λ¥Ό λ³€μλ‚ ν”λ μ΄λ¶μ— **ν‰λ¬ΈμΌλ΅ μ €μ¥**ν•λ©΄ λ³΄μ•μƒ μ·¨μ•½ν•  μ μμ.
- μ΄λ° λ―Όκ° μ •λ³΄λ¥Ό **μ•”νΈν™”**ν•μ—¬ κ΄€λ¦¬ν•  μ μλ„λ΅ Ansibleμ—μ„λ” `Ansible Vault` κΈ°λ¥μ„ μ κ³µν•¨.
- `Ansible Vault`λ” μ¤‘μ”ν• νμΌμ„ **μ•”νΈν™”**, **νΈμ§‘**, **λ³΄κΈ°**, **λ³µνΈν™”**, **μ•”νΈ λ³€κ²½** λ“±μ„ κ°€λ¥ν•κ² ν•΄μ¤.

---

## π› οΈ μ£Όμ” λ…λ Ήμ–΄

### π” 1. μ•”νΈν™”λ νμΌ μƒμ„±

```bash
ansible-vault create <νμΌλ…>
```

#### Step 1.

- μμ‹:

```bash
ansible-vault create mysecret.yml
```

- μ‹¤ν–‰ν•λ©΄ λΉ„λ°€λ²νΈ μ…λ ¥ ν”„λ΅¬ν”„νΈκ°€ λ‚νƒ€λ‚κ³ , μ„¤μ •ν• λΉ„λ°€λ²νΈλ΅ νμΌμ΄ μ•”νΈν™”λ¨.
- μ•”νΈν™”λ νμΌμ€ `.yml` κ·Έλ€λ΅ μ μ§€λμ§€λ§ λ‚΄λ¶€ λ‚΄μ©μ€ μ•”νΈν™”λμ–΄ μμ.

---

### μ•”νΈν™”λ νμΌ λ§λ“¤κΈ°
 
#### Step 2. λ…λ Ή μ‹¤ν–‰κ³Ό λ™μ‹μ— 'viμ—λ””ν„°'λ΅ μ§„μ…ν•λ”λ° λ‹¤μκ³Ό κ°™μ€ λ‚΄μ©μ„ μ…λ ¥ν•λ‹¤.
- "~/.ansible/tmp/ansible-local-2690c59jq_xu/tmpyb8hbqhy.yml" 3L, 35C μ™€ κ°™μ€ λ‚΄μ©μ΄ λ³΄μ΄λ”λ° 'μ„μ‹ μ €μ¥ νμΌ' μƒνƒμ—μ„ νΈμ§‘ν•λ‹¤.

#### Step 3. μƒμ„±λ νμΌ ν™•μΈ λ° λ‚΄μ© ν™•μΈ
```
 ll mysecret.yml

 cat mysecret.yml
```

![](./img/20250522/0001.png)

#### Step 4. 

### π”’ 2. κΈ°μ΅΄ νμΌ μ•”νΈν™”

```bash
ansible-vault encrypt <νμΌλ…>
```

- μμ‹:

```
[root@localhost my-ansible]# ansible-vault encrypt create-user.yml
New Vault password:
Confirm New Vault password:
Encryption successful
```

---

### π”“ 3. μ•”νΈν™”λ νμΌ λ³µνΈν™”

```
ansible-vault decrypt <νμΌλ…>
```

- μμ‹:

```
ansible-vault decrypt mysecret.yml
```

![](./img/20250522/0004.png)


---

### βοΈ 4. μ•”νΈν™”λ νμΌ νΈμ§‘

```bash
ansible-vault edit <νμΌλ…>
```

- μμ‹:

```bash
ansible-vault edit mysecret.yml
```

![](./img/20250522/0002.png)

![](./img/20250522/0003.png)

---

### π” 5. μ•”νΈν™”λ νμΌμ λΉ„λ°€λ²νΈ λ³€κ²½

```bash
ansible-vault rekey <νμΌλ…>
```

- μμ‹:

```bash
ansible-vault rekey mysecret.yml
```

---

### π€ 6. μ•”νΈν™”λ ν”λ μ΄λ¶ μ‹¤ν–‰

```bash
ansible-playbook <νμΌλ…> --ask-vault-pass
```

- μμ‹:

```bash
ansible-playbook mysecret.yml --ask-vault-pass
```

---

## π“ μ‹¤μµ νλ¦„ μμ‹

```bash
# λ””λ ‰ν† λ¦¬ μ΄λ™
cd my-ansible

# νμΌ μƒμ„± λ° μ•”νΈν™”
ansible-vault create mysecret.yml
```

---

## β… λ³΄μ• ν

- λΉ„λ°€λ²νΈλ” κ³µμ ν•μ§€ λ§κ³ , ν€ μ‘μ—… μ‹μ—λ” `--vault-password-file` κΈ°λ¥ ν™μ© κ³ λ ¤
- λ―Όκ°ν• λ‚΄μ©μ€ κ°€κΈ‰μ  λ³„λ„μ λ³€μ νμΌλ΅ λ¶„λ¦¬ν•΄μ„ κ΄€λ¦¬

---

# μ•”νΈν™”λ ν”λ μ΄λ¶ μ‹¤ν–‰

## Step 1. 'μ•”νΈν™”λ ν”λ μ΄λ¶ μ‹¤ν–‰'μ„ μ„ν• μ‚¬μ „ μ‘μ—…

![](./img/20250522/0005.png)

## Step 2. ν”λ μ΄λ¶ νμΌ νΈμ§‘
- /root/my-ansible/create-user.yml
```
---


- hosts: db
  vars_files:
    - vars/mysecret.yml


  tasks:
    - name: Create User {{ user }}
      ansible.builtin.user:
        name: "{{ user }}"
        state: present
```

![](./img/20250522/0005.png)

## Step 3. ν”λ μ΄λ¶ μ•”νΈν™”λ νμΌ μ‹¤ν–‰ 1. μ¤λ¥

![](./img/20250522/0007.png)


## Step 4. ν”λ μ΄λ¶ μ•”νΈν™”λ νμΌ μ‹¤ν–‰ 2. μ •μƒ

![](./img/20250522/0006.png)


## Step 5. λΉ„λ°€λ²νΈ μλ™ μ…λ ¥κ³Ό ν•¨κ» ν”λ μ΄λ¶ μ‹¤ν–‰

![](./img/20250522/0008.png)


