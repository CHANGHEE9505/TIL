# Ansible ì‹¤ìŠµ 2.

## ì²« ë²ˆì§¸ í”Œë ˆì´ë¶ ì‘ì„±í•˜ê¸°
### í”Œë ˆì´ë¶ í™˜ê²½ ì„¤ì • 
- 'Ansible'(root/my-ansible/ansible.cfg)
 
```
[root@localhost my-ansible]# vi ansible.cfg
[root@localhost my-ansible]#
[root@localhost my-ansible]# cat ansible.cfg
[defaults]
inventory = ./inventory
remote_user = user
ask_pass = false

[privilege_escalation]
become = true
become_methode = sudo
become_user = root
become_ask_pass = false
```
### SSH key ìƒì„±
```
ssh-keygen
ì—”í„° x 3
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:3i/IatRDKlTC/ZZwFtOEFKOE6yaUxQzPbfGl/LWvOEU root@localhost.localdomain
The key's randomart image is:
+---[RSA 2048]----+
|  .= oo.**o      |
|   oBo+=+=.      |
|   oo++=+.  .    |
|  o o.  =. .E.   |
| . o   =S ...    |
|  . + o.o.  ..   |
|   o o ..o..  .  |
|      . o oo .   |
|     ...  .oo    |
+----[SHA256]-----+
```
### ê´€ë¦¬ ë…¸ë“œ(Ansible Node ì„œë²„ë“¤)ë¡œ ë³µì‚¬


### ì²« ë²ˆì§¸ í”Œë ˆì´ë¶ ì‘ì„±í•˜ê¸°
#### í”Œë ˆì´ë¶ ì‘ì„±í•˜ê¸°
(ansible-rocky810)# cd /root/my-ansible
(ansible-rocky810)# vi first-playbook.yml

![](./img/20250521/0001.png)

#### í”Œë ˆì´ë¶ ë¬¸ë²• ì²´í¬í•˜ê¸°

![](./img/20250521/0002.png)

#### í”Œë ˆì´ë¶ ì‹¤í–‰ ì ê²€í•˜ê¸°

##### Step 1. 'sshd ì„œë¹„ìŠ¤' ë¥¼ ìœ„í•œ 'íŒŒì¼(restart-service.yml)' ìƒì„±

##### Step 2. ê° 'Node Server'ì—ì„œ 'sshd' ì„œë¹„ìŠ¤(ë°ëª¬) ì‹¤í–‰ í•˜ê¸° ì „ì— 'check'

![](./img/20250521/0003.png)

##### Step 3. ê° 'Node Server'ì—ì„œ 'sshd' ì„œë¹„ìŠ¤(ë°ëª¬) ì‹¤í–‰

![](./img/20250521/0004.png)
```
systemctl enable ssh ---> ìš°ë¶„íˆ¬ì—ì„œ
```
![](./img/20250521/0005.png)



##### Step 4. log (/var/log/messages)

```
May 21 03:13:50 localhost systemd[2212]: tracker-extract.service: Scheduled restart job, restart counter is at 2.
May 21 03:13:50 localhost systemd[2212]: Stopped Tracker metadata extractor.
May 21 03:13:50 localhost systemd[2212]: Starting Tracker metadata extractor...
.... ê³„ì†ë‚˜ì˜´
```

##### Step 5. 

## 3. ë³€ìˆ˜ì™€ íŒ©íŠ¸ ì‚¬ìš©í•˜ê¸°

### ğŸ“Œ ë³€ìˆ˜ì™€ íŒ©íŠ¸ ì‚¬ìš©í•˜ê¸°

Ansibleì—ì„œëŠ” ë™ì¼í•œ ì½”ë“œ êµ¬ë¬¸ì— ì…ë ¥ë˜ëŠ” ê°’ì— ë”°ë¼ ë™ì‘ì„ ë³€ê²½í•˜ì—¬ **ë°˜ë³µì ì¸ ì‚¬ìš©**ì´ ê°€ëŠ¥í•˜ë„ë¡ ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë³€ìˆ˜ë¥¼ ì–´ë””ì— ì •ì˜í•˜ëŠëƒì— ë”°ë¼ ë‹¤ìŒê³¼ ê°™ì´ ë¶„ë¥˜ë©ë‹ˆë‹¤.

- **ê·¸ë£¹ ë³€ìˆ˜ (Group Variables)**
- **í˜¸ìŠ¤íŠ¸ ë³€ìˆ˜ (Host Variables)**
- **í”Œë ˆì´ ë³€ìˆ˜ (Play Variables)**

---

### ğŸ”¸ ì¼ë°˜ì ì¸ ì˜ë¯¸ì˜ ë³€ìˆ˜ ì¢…ë¥˜

| ì¢…ë¥˜ | ì„¤ëª… |
|------|------|
| ì¼ë°˜ ë³€ìˆ˜ | ì¼ë°˜ì ì¸ ë‚´ìš©ì„ ì €ì¥ |
| ë³´ì•ˆ ë³€ìˆ˜ | íŒ¨ìŠ¤ì›Œë“œì²˜ëŸ¼ ì•”í˜¸í™”ê°€ í•„ìš”í•œ ì •ë³´ë¥¼ ì €ì¥ |
| ì‹œìŠ¤í…œ ë³€ìˆ˜ (íŒ©íŠ¸) | ì‹œìŠ¤í…œì—ì„œ ìˆ˜ì§‘í•œ ê°’ë“¤ì„ ì €ì¥ |

---

### ğŸ”¸ ë³€ìˆ˜ì˜ ì¢…ë¥˜ì™€ ì‚¬ìš©ë²•

Ansibleì€ ë‹¤ì–‘í•œ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—… ê°’ì„ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ì‚¬ìš©ì
- ì„¤ì¹˜í•  íŒ¨í‚¤ì§€
- ì¬ì‹œì‘í•  ì„œë¹„ìŠ¤
- ìƒì„± ë˜ëŠ” ì‚­ì œí•  íŒŒì¼ëª… ë“±

ì´ë¥¼ í†µí•´ **í”Œë ˆì´ë¶ì„ ì¬ì‚¬ìš©**í•  ìˆ˜ ìˆê³ , **ì‚¬ìš©ì ì…ë ¥ê°’ì„ ì‰½ê²Œ ë°˜ì˜**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Ansibleì—ì„œ ì‚¬ìš©ë˜ëŠ” ë³€ìˆ˜ ì¢…ë¥˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- **ê·¸ë£¹ ë³€ìˆ˜ (Group Vars)**
- **í˜¸ìŠ¤íŠ¸ ë³€ìˆ˜ (Host Vars)**
- **í”Œë ˆì´ ë³€ìˆ˜ (Play Vars)**
- **ì¶”ê°€ ë³€ìˆ˜ (Extra Vars)**
- **ì‘ì—… ë³€ìˆ˜ (Task Vars)** â†’ í”Œë ˆì´ ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©

---

> âœ… ì •ë¦¬: ë³€ìˆ˜ í™œìš©ì„ í†µí•´ ì½”ë“œ ì¬ì‚¬ìš©ì„±ì„ ë†’ì´ê³ , ë‹¤ì–‘í•œ í™˜ê²½ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê·¸ë£¹ ë³€ìˆ˜

#### Step 1. '/root/my-ansible/inventory' íŒŒì¼ ìˆ˜ì •

```
[web]
tnode1-rocky8101.exp.com
tnode2-ubuntu.exp.com

[db]
tnode3-rocky8102.exp.com

[all:children]
web
db

[all:vars]
user=ansible            ----> ì•„ë˜ ë‘ì¤„ ì¶”ê°€
```
#### Step 2. '/root/my-ansible/create-user.yml' íŒŒì¼ ìƒì„±

```
---


- hosts: all
  tasks:
    - name: Create User {{ user }}
      ansible.builtin.user:
        name: "{{ user }}"
        state: present
```

#### Step 3. í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250521/0006.png)
```
ansible-playbook create-user.yml
```

#### Step 4. ê° 'Node Server'ì—ì„œ í™•ì¸

![](./img/20250521/0007.png)

### í˜¸ìŠ¤íŠ¸ ë³€ìˆ˜ (ë³€ìˆ˜ë¥¼ í•´ë‹¹ í˜¸ìŠ¤íŠ¸ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.)

#### Step 1. (root/my-ansible/inventory) ìˆ˜ì •

```
[web]
tnode1-rocky8101.exp.com
tnode2-ubuntu.exp.com

[db]
tnode3-rocky8102.exp.com user=ansible1

[all:children]
web
db

[all:vars]
user=ansible
```

#### Step 2. (root/my-ansible/create-user1.yml) íŒŒì¼ ìƒì„±

```
---


- hosts: db
  tasks:
    - name: Create User {{ user }}
      ansible.builtin.user:
        name: "{{ user }}"
        state: present
```

#### Step 3. í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250521/0008.png)

#### Step 4. ê° 'Node Server' ì—ì„œ í™•ì¸

![](./img/20250521/0009.png)

### í”Œë ˆì´ ë³€ìˆ˜ (í”Œë ˆì´ë¶ ë‚´ì—ì„œ ì„ ì–¸ë˜ëŠ” ë³€ìˆ˜ë¥¼ ë§í•œë‹¤.)

#### Step 1. (root/my-ansible/create-user3.yml) íŒŒì¼ ìƒì„±
```
---


- hosts: all
  vars:
    user: ansible2


  tasks:
  - name: Create User {{ user }}
    ansible.builtin.user:
      name: "{{ user }}"
      state: present
```
#### Step 2. í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250521/0010.png)
```
ansible-playbook create-user3.yml
```

#### Step 3. í™•ì¸

![](./img/20250521/0011.png)

#### Step 4. í”Œë ˆì´ ë³€ìˆ˜ë¥¼ ë³„ë„ì˜ íŒŒì¼ë¡œ ë¶„ë¦¬, ì •ì˜í•˜ê³  í”Œë ˆì´ë¶ì— ì„ ì–¸í•˜ëŠ” ë³€ìˆ˜ (root/my-ansible/vars/users.yml)

```
---


- hosts: all
  vars_files:
    - vars/users.yml


  tasks:
  - name: Create User {{ user }}
    ansible.builtin.user:
      name: "{{ user }}"
      state: present
```

#### Step 5. ì‹¤í–‰
![](./img/20250521/0012.png)

#### Step 6. í™•ì¸

![](./img/20250521/0013.png)

### ì¶”ê°€ ë³€ìˆ˜ (íŒŒë¼ë¯¸í„° ì‹¤í–‰í•  ë•Œ)

![](./img/20250521/0014.png)
```
ansible-playbook -e user=ansible5 create-user4.yml
```

-e ì˜µì…˜ì€ --extra_varsì˜ ì•½ì–´ë¡œ **ì¶”ê°€ ë³€ìˆ˜**ë¥¼ ì˜ë¯¸í•¨

#### í™•ì¸

![](./img/20250521/0015.png)


### ì‘ì—… ë³€ìˆ˜

- ê°œìš”
    - ì‘ì—… ë³€ìˆ˜ëŠ” í”Œë ˆì´ë¶ì˜ íƒœìŠ¤í¬ ë¶€í–‰ ê²°ê³¼ë¥¼ ì €ì¥í•œ ê²ƒì„ ì˜ë¯¸í•œë‹¤.
    - íŠ¹ì • ì‘ì—… ìˆ˜í–‰ í›„ ê·¸ ê²°ê³¼ë¥¼ í›„ì† ì‘ì—…ì—ì„œ ì‚¬ìš©í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©ëœë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´ í´ë¼ìš°ë“œ ì‹œìŠ¤í…œì— VMì„ ìƒì„±í•œë‹¤ê³  ê°€ì •í•´ë³´ê² ë‹¤.
    ì´ë¥¼ ìœ„í•´ì„œëŠ” ë„¤íŠ¸ì›Œí¬ë‚˜ ìš´ì˜ì²´ì œ ì´ë¯¸ì§€ì™€ ê°™ì€ ê°€ìƒ ìì›ì´ í•„ìš”í•˜ë‹¤. ê°€ìƒ ìì›ì„ ì¡°íšŒí•˜ê³ , ê²°ê³¼ë¥¼ ê°€ì§€ê³  VMì„ ìƒì„±í•  ë•ŒëŠ” ì‘ì—… ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì¢‹ë‹¤.
    - (í•µì‹¬) ëª…ë ¹ì˜ ê²°ê³¼ë¥¼ í™”ë©´ì— ì¶œë ¥í•  ë¿ì´ë‹¤.

#### Step 1. (root/my-ansible/create-user6.yml) íŒŒì¼ ì¶”ê°€

- create-user1.yml íŒŒì¼ì„ create-user6.yml íŒŒì¼ë¡œ ë³µì‚¬í•œë‹¤.
- create-user6.yml íŒŒì¼ì„ ì—´ê³  Create User íƒœìŠ¤í¬ì— 'register:result'ë¼ëŠ” ë¬¸êµ¬ë¥¼ ì¶”ê°€í•œë‹¤.
- registerë¥¼ ì„ ì–¸í•˜ë©´ íƒœìŠ¤í¬ë¥¼ ì‹¤í–‰í•œ ê²°ê³¼ë¥¼ register ë‹¤ìŒì— ë‚˜ì˜¤ëŠ” resultë¼ëŠ” ë³€ìˆ˜ì— ì €ì¥í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ê°€ ëœë‹¤.ê·¸ë¦¬ê³  resultë¼ëŠ” ë³€ìˆ˜ì— ì €ì¥í•œ ê²°ê³¼ë¥¼ debug ëª¨ë“ˆì„ í†µí•´ ì¶œë ¥í•œë‹¤.
```
---


- hosts: db
  tasks:
  - name: Create User {{ user }}
    ansible.builtin.user:
      name: "{{ user }}"
      state: present
    register: result

  - ansible.builtin.debug:
      var: result
```

#### Step 2. íŒŒì¼ ì‹¤í–‰
![](./img/20250521/0016.png)

```
ansible-playbook -e user=ansible6 create-user6.yml
```

#### Step 3. í™•ì¸

![](./img/20250521/0017.png)


