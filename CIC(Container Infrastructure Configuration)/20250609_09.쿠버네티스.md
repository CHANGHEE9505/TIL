# 10. 'kubernetes'를 담당하는 서비스

## 개요
- 외부 사용자가 'Pod('Container' 들의 묶음)'를 이용하는 방법을 말한다.
- 'Kubenetes'에서는 외부에서 'kubebetes' 클러스터에 접속하는 방법 을 서비스 라고 한다.
- Pod를 생성하는 방법
    - 인터넷에서 배포하고 있는 이미지를 가져와서 생성
    ```
    kubectl create deployment no-pods --image=sysnet4admin/echo-hname
    ```
    - 배포하고 있는 이미지를 등록한 'yaml' 파일을 실행해서 생성
    ```
    kubectl create -f echo-hname.yaml
    ```

## NodePort
### 개요
- 외부에서 'Kubenetes' 클러스터의 내부에 접속하는 가장 쉬운 방법을 말한다.
- 'NodePort Service'를 설정하면 모든 'Worker Node'의 특정 포트('NodePort')를 열고 여기로 오는 모든 요청을 'NodePort Service'로 전달한다.
- 이렇게 전달받은 'NodePort Service'는 해당 업무를 처리할 수 있는 'Pod'로 요청을 전달한다.
    

### Step 1. 'NodePort Service'로 외부에서 접속하기
```
sysnet4admin/echo-hname
```

### Step 2. 배포된 pods 확인

![](./img/20250609.img/0001.png)

### Step 3. 'NodePort Service'를 생성
```
[root@m-k8s ~]# kubectl create -f nodeport.yaml
```
### Step 4. 생성한 서비스(service/np-svc created)
```
kubectl get services

10.110.165.182는 'kubenetes' 클러스터의 내부에서 사용하는 IP로 자동 지정
```
![](./img/20250609.img/0002.png)

### Step 5. 외부에서 접속을 하기 위한 'kubenetes'의 work node 의 IP를 확인

![](./img/20250609.img/0003.png)

### Step 6. 'Host OS(windows 10)'의 웹 브라우저에서 '192.168.1.10 ~ 192.168.1.103'과 '30000번' 으로 접속

### Step 7. 
#### 이미지를 로딩한다.

![](./img/20250609.img/0004.png)
![](./img/20250609.img/0005.png)

#### Pod를 생성한다.

![](./img/20250609.img/0006.png)

#### Node 및 Service, Namespace 모두 확인한다.

![](./img/20250609.img/0007.png)

#### pod 제거 및 재생성

![](./img/20250609.img/0008.png)

#### 

## 부하 분산
### 개요
- 'Deployment'로 생성된 'Pod' 1개에 접속하고 있는 도중에 'Pod'가 '3개'로 증가할 경우 접속은 어떤 식으로든 영향을 받게 된다.

- 이와 같은 경우에 부하가 분산되는지를 확인한다.

### 실행 1. sysnet4admin/echo-hname 이미지