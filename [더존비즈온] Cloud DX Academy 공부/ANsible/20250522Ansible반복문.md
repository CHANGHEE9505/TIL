# Ansible ë°˜ë³µë¬¸

## ë‹¨ìˆœ ë°˜ë³µë¬¸

### ê°œìš”
- íŠ¹ì • í•­ëª©ì— ëŒ€í•œ ì‘ì—…ì„ ë°˜ë³µí•œë‹¤.
- 'loop' í‚¤ì›Œë“œë¥¼ ì‘ì—…ì— ì¶”ê°€í•˜ë©´ ì‘ì—…ì„ ë°˜ë³µí•´ì•¼ í•˜ëŠ” í•­ëª©ì˜ ëª©ë¡ì„ ê°’ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- í•´ë‹¹í•˜ëŠ” ê°’ì„ ì‚¬ìš©í•˜ë ¤ë©´ 'item' ë³€ìˆ˜(ë§¤ê°œë³€ìˆ˜)ë¥¼ ì´ìš©í•œë‹¤.


### Step 1. 'sshd ì„œë¹„ìŠ¤'ì™€ 'rsyslog  ì„œë¹„ìŠ¤'ì˜ ìƒíƒœ ì²´í¬ë¥¼ 'ansible.builtin.service' ëª¨ë“ˆì„ ì´ìš©í•œ íŒŒì¼ ìƒì„±
#### /root/my-ansible/check-services.yml
```
---

- hosts: all
  tasks:
    - name: Check sshd state
      ansible.builtin.service:
        name: sshd
        state: started


    - name: Check rsyslog state
      ansible.builtin.service:
        name: rsyslog
        state: started
```
### Step 2. í”Œë ˆì´ë¶ ì‹¤í–‰
![](./img/20250522/0016.png)

### Step 3. í…ŒìŠ¤íŠ¸
```
[root@localhost my-ansible]# ssh root@192.168.100.7
Activate the web console with: systemctl enable --now cockpit.socket

Last login: Thu May 22 02:13:37 2025 from 192.168.100.4
[root@localhost ~]#
[root@localhost ~]# netstat -atunp | grep sshd | nl
     1  tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      733/sshd
     2  tcp        0      0 192.168.100.7:22        192.168.100.4:44240     ESTABLISHED 25446/sshd: root [p
     3  tcp6       0      0 :::22                   :::*                    LISTEN      733/sshd
```

### Step 4. 'loop' í‚¤ì›Œë“œë¥¼ ì´ìš©í•œ ë°˜ë³µë¬¸ ì ìš©

#### /root/my-ansible/check-services1.yml

```
     1 ---
      2
      3 - hosts: all
      4   tasks:
      5     - name: Check sshd and rsyslog state
      6       ansible.builtin.service:
      7         name: "{{ item }}"
      8         state: started
      9       loop:
     10         - sshd
     11         - rsyslog
```

### Step 5. í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250522/0017.png)

### Step 6. í…ŒìŠ¤íŠ¸

![](./img/20250522/0018.png)

### Step 7.

'loop'ë¬¸ì— ì‚¬ìš©í•˜ëŠ” 'item'ì„  ë³€ìˆ˜ì— ì €ì¥í•˜ë©´ 'loop'í‚¤ì›Œë“œì— í•´ë‹¹ ë³€ìˆ˜ë¥¼ ì‚¬ìš© ê°€ëŠ¥

#### /root/my-ansible/check-services2.yml
```
---

- hosts: all
  vars:
    services:
      - sshd
      - rsyslog

  tasks:
    - name: Check sshd and rsyslog state
      ansible.builtin.service:
        name: "{{ item }}"
        state: started
      loop: "{{ services }}"
```

### Step 8. í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250522/0019.png)


## ğŸ” Ansible ë°˜ë³µë¬¸: ì‚¬ì „ ëª©ë¡ì— ì˜í•œ ë°˜ë³µ

### ğŸ“Œ ê°œìš”

- Ansibleì—ì„œëŠ” `loop`ë¥¼ ì‚¬ìš©í•´ ë°˜ë³µ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒ
- ë‹¨ìˆœ ë¬¸ìì—´ ëª©ë¡ë¿ ì•„ë‹ˆë¼, **ì‚¬ì „(dictionary)ì˜ ëª©ë¡**ì„ í™œìš©í•˜ë©´ ë” ë³µì¡í•œ êµ¬ì¡°ì˜ ë°˜ë³µë„ ê°€ëŠ¥
- ì˜ˆ: ì‚¬ìš©ì ê³„ì • ìƒì„± ì‹œ ì´ë¦„, íŒ¨ìŠ¤ì›Œë“œ, ì…¸ ë“± ì—¬ëŸ¬ í•­ëª©ì„ í•¨ê»˜ ì •ì˜

---

### Step 1. 'loop í‚¤ì›Œë“œ' ì•„ë˜ì— 'log-path'ë¼ëŠ” ë³€ìˆ˜ì™€ 'log-mode'ë¼ëŠ” ë³€ìˆ˜ ì„ ì–¸

#### /root/my-ansible/make-file
```
---

- hosts: all

  tasks:
    - name: Create files
      ansible.builtin.file:
        path: "{{ item['log-path'] }}"
        mode: "{{ item['log-mode'] }}"
        state: touch
      loop:
        - log-path: /var/log/test1.log
          log-mode: '0644'
        - log-path: /var/log/test2.log
          log-mode: '0600'
```

### Step 2. í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250522/0020.png)

### Step 3. í”Œë ˆì´ë¶ í™•ì¸

![](./img/20250522/0021.png)

## ì´ì „ ì•¤ì„œë¸” ìŠ¤íƒ€ì¼ ë°˜ë³µë¬¸ (ìƒëµ)

## ë°˜ë³µë¬¸ê³¼ Register ë³€ìˆ˜ ì‚¬ìš©

### Step 1. register í‚¤ì›Œë“œë¥¼ ì´ìš©í•œ ì‹¤í–‰ ê²°ê³¼ë¥¼ ë³€ìˆ˜ë¡œ ì €ì¥

#### /root/my-ansible/loop_register.yml
```
---
- hosts: localhost
  tasks:
    - name: loop echo test
      ansible.builtin.shell: "echo 'I can speak {{ item }}'"
      loop:
        - Korean
        - English
      register: result

    - name: Show result
      ansible.builtin.debug:
        var: result
```

### Step 2. í”Œë ˆì´ë¶ ì‹¤í–‰

![](./img/20250522/0022.png)
![](./img/20250522/0023.png)

### Step 3. 'results'ì˜ íŠ¹ì •ê°’ì„ í”Œë ˆì´ë¶ì—ì„œ ì‚¬ìš©í•  ê²½ìš° 'loop'ë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 
#### /root/my-ansible/loop_register1.yml
```
---
- hosts: localhost
  tasks:
    - name: loop echo test
      ansible.builtin.shell: "echo 'I can speak {{ item }}'"
      loop:
        - Korean
        - English
      register: result

    - name: Show result
      ansible.builtin.debug:
        msg: "Stdout: {{ item.stdout }}"
      loop: "{{ result.results }}"
```
### Step 4. í”Œë ˆì´ë¶ ì‹¤í–‰
![](./img/20250522/0024.png)