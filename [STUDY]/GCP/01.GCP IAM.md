# GCP IAM (Identity and Access Management) 정리

## 1. IAM 개념 설명

GCP의 IAM(Identity and Access Management)은
**"누가(Identity) 어떤 리소스에 대해 무엇을 할 수 있는지(Access)를 제어하는 보안 시스템"**이다.

AWS IAM과 유사하지만, GCP는 **리소스 계층 구조 기반 권한 상속**이 핵심 특징이다.

### 📌 IAM의 3가지 핵심 요소

| 요소        | 설명                         |
| --------- | -------------------------- |
| Principal | 권한을 받는 대상 (사용자, 그룹, 서비스계정) |
| Role      | 할 수 있는 작업들의 묶음             |
| Resource  | 대상 리소스 (Project, VM, DB 등) |

### 예시

* Principal: `dev@company.com`
* Role: `Compute Admin`
* Resource: `project-a`

👉 결과: 해당 사용자는 project-a에서 VM 생성/삭제 가능

---

## 2. 주요 기능

### 1) 접근 제어 (Access Control)

* 누가 어떤 리소스에 접근 가능한지 정의
* 최소 권한 원칙(Least Privilege) 적용

### 2) 사용자/그룹 권한 관리

* Google 사용자 계정
* 조직 그룹
* 외부 사용자

### 3) 서비스 권한 관리

* 서버
* 애플리케이션
* API

### 4) 계층형 권한 상속 구조

권한은 상위 → 하위로 자동 상속됨

```
Organization
   ↓
Folder
   ↓
Project
   ↓
Resource
```

예시:

* Organization 레벨에서 Viewer 권한 부여
  → 모든 Project에서 조회 가능

---

## 3. 정책 관리 (Policy Management)

### IAM Policy란?

**"누가 어떤 Role을 가지는지 정의한 설정(JSON 기반)"**

구조:

```
Policy
 ├─ bindings
 │    ├─ role
 │    └─ members
```

### 개념 예시

* role: `roles/storage.admin`
* members:

  * user:a@gmail.com
  * group:dev@company.com

### 정책 적용 범위

* Organization
* Folder
* Project
* Resource

상위 정책은 하위로 자동 상속됨.

### 권한(Role) 종류

| 타입              | 설명                      |
| --------------- | ----------------------- |
| Basic Role      | Owner / Editor / Viewer |
| Predefined Role | GCP에서 제공하는 세분화된 역할      |
| Custom Role     | 직접 정의하는 역할              |

실무 권장:

* Basic Role은 거의 사용하지 않음
* Predefined + Custom Role 위주 사용

---

## 4. 서비스 계정 (Service Account)

### 서비스 계정이란?

**"사람이 아니라 시스템이 사용하는 계정"**

### 사용 예시

* VM → BigQuery 접근
* Cloud Run → Storage 접근
* Kubernetes → Pub/Sub 접근

### 형태

```
my-service@project-id.iam.gserviceaccount.com
```

### 사용 방식

1. 리소스에 서비스 계정 연결

* VM 생성 시 서비스 계정 부착

2. 서비스 계정에 Role 부여

* 예: Storage Admin

👉 결과:

* VM은 별도 인증 없이 Storage 접근 가능

### 특징

* 비밀번호 없음
* 키 기반 인증
* 서버 간 통신에 필수
* 자동 인증 처리

### AWS 비교

* IAM Role + EC2 Instance Profile와 유사

---

## 5. 조직 정책 (Organization Policy)

IAM보다 상위 개념의 보안 제어 장치

**"조직 전체에 강제 보안 규칙을 설정하는 기능"**

### 예시 정책

* 특정 리전만 사용 가능
* 외부 IP 생성 금지
* 서비스 계정 키 생성 금지

### 특징

* 보안 가드레일 역할
* Organization → Folder → Project에 적용
* 개발자가 임의 변경 불가

### 자주 쓰는 정책 예시

* `disableServiceAccountKeyCreation`
* `restrictVpcPeering`
* `allowedLocations`

---

## 6. 요약

### IAM 한 줄 정의

> GCP 리소스 접근 권한을 통제하는 핵심 보안 시스템

### 핵심 구조

```
Principal + Role + Resource = Access Control
```

### 가장 중요한 개념 TOP 4

1. Role

   * 권한 묶음

2. Policy

   * 누가 어떤 Role을 가지는지 정의

3. Service Account ⭐ (가장 중요)

   * 시스템용 계정

4. 계층 상속 구조

   * Organization → Folder → Project

### 실무 중요도 순위

1. 서비스 계정 ⭐⭐⭐⭐⭐
2. 역할 설계 ⭐⭐⭐⭐
3. 정책 상속 이해 ⭐⭐⭐⭐
4. 조직 정책 ⭐⭐⭐

---
