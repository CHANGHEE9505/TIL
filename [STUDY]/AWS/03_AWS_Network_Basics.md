# AWS를 이해하기 위한 기초지식: Network (OSI 7 Layer Model (2))

이 문서는 OSI 7 계층 모델 중 네트워크 계층(Layer 3)과 데이터 링크 계층(Layer 2)의 핵심 개념을 설명하며, 특히 IP 주소 체계, 네트워크 주소 지정, 그리고 라우팅 및 주소 결정 프로토콜에 중점을 둡니다.

## 1. Local Network (로컬 네트워크)

- 스위치(L2)를 통해 여러 클라이언트가 연결된 로컬 통신 환경을 의미합니다.
- 동일한 로컬 네트워크 내의 장치들은 스위치를 통해 통신합니다.

## 2. Network Layer (네트워크 계층)

- **정의**: 여러 노드(장치) 간의 경로를 찾아 올바르게 데이터를 전달하는 기능과 수단을 정의합니다.
- **주요 단위**: 패킷 (Packet)
- **주요 구성 요소**:
    - **Router (라우터)**: 네트워크 간 패킷을 전달하는 Layer 3 장치. IP 대역별 최적 경로를 수집 및 관리하며, 이를 바탕으로 특정 IP 주소를 대상으로 하는 패킷을 전달합니다.
    - **IP (Internet Protocol)**: 인터넷 프로토콜 상에서 통신 주체(장치)를 식별하기 위한 고유한 주소입니다.
    - **ARP (Address Resolution Protocol)**: IP 주소에 해당하는 MAC 주소를 찾기 위한 프로토콜입니다.
- **주요 특징**:
    - 서로 떨어진 Local Network 간의 통신을 지원 (Inter Network -> Internet).
    - 중간 노드(라우터)를 거쳐 목적지까지 도달하는 방법을 지원합니다.

### Network Layer가 해결하지 못한 문제:

- 한 번에 하나의 통신만 가능 (여러 애플리케이션이 동시에 통신 불가).
- 패킷의 순서 보장 / 유실에 대한 대응 불가.

## 3. IP (Internet Protocol) Address

- **개념**: 인터넷에서 통신 주체를 식별하는 아이디. MAC Address와 다르게 수시로 변동 가능합니다.
- **두 가지 종류**:
    - **IPv4 (32 Bits)**: 약 43억 개의 주소를 가질 수 있으며, IP를 효율적으로 사용하기 위해 사설(Private) IP와 공인(Public) IP로 나뉩니다.
    - **IPv6 (128 Bits)**: 약 3.4 x 10^38 개의 주소를 가질 수 있어, IPv4보다 훨씬 많은 주소를 제공합니다. 이로 인해 사설 IP 개념이 불필요합니다.

## 4. Classless Inter-Domain Routing (CIDR)

- **개념**: IP 주소 공간을 여러 네트워크 영역으로 나누기 위해 IP를 묶는 방식입니다. 여러 개의 사설망을 효율적으로 구축하는 데 사용됩니다.
- **CIDR Notation**: `A.B.C.D/E` 형식으로 표현됩니다.
    - `A.B.C.D`: 네트워크 주소와 호스트 주소를 나타냅니다.
    - `E`: 네트워크 주소가 몇 비트인지 나타내며, 0부터 32까지의 값을 가집니다.
- **CIDR Block**: 호스트 주소 비트만큼 IP 주소를 보유할 수 있습니다. 예를 들어, `192.168.2.0/24`는 네트워크 비트가 24이고 호스트 비트는 `32-24=8`이므로, `2^8 = 256`개의 IP 주소(`192.168.2.0` ~ `192.168.2.255`)를 가집니다.

## 5. Subnet Mask (서브넷 마스크)

- **개념**: IP 주소에서 어느 부분이 호스트 비트이고 어느 부분이 네트워크 비트인지를 구분해주는 마스크입니다.
- **활용**: AND 연산을 사용하여 네트워크 주소를 필터링합니다. 네트워크 비트 수만큼 1을 가진 마스크를 IP 주소에 적용하면 네트워크 비트만 추출할 수 있습니다.
    - **AND 연산**: 두 비트가 모두 1일 때만 결과가 1이 됩니다.
        - `1 AND 1 = 1`
        - `0 AND 1 = 0`
        - `1 AND 0 = 0`

## 6. 라우터와 ARP의 동작 원리

- **라우터로의 데이터 전달**:
    - 목적지 IP 주소가 로컬 네트워크에 없는 경우, 라우터로 패킷을 전달합니다.
    - 라우터의 IP는 알지만 MAC 주소를 모를 경우, ARP를 활용하여 MAC 주소를 알아냅니다.
- **ARP (Address Resolution Protocol)**:
    - IP 주소로 MAC 주소를 찾는 프로토콜입니다.
    - **순서**:
        1. 대상 IP 주소를 브로드캐스트(MAC Address `FF:FF:FF:FF:FF:FF`)로 요청합니다.
        2. 응답 받은 IP와 MAC 주소를 기반으로 MAC 주소를 확정하고 테이블에 저장합니다.
- **패킷 전달 과정 (Network Layer)**:
    - 소스 IP, 대상 IP, Payload ("AWS 강의실"), TTL (Time To Live), 기타 정보로 구성된 패킷이 생성됩니다.
    - TTL은 패킷이 얼마나 많은 노드를 거쳐 전달될 수 있는지를 나타냅니다.
- **프레임 생성 (Data Link Layer)**:
    - 패킷은 데이터 링크 계층에서 프레임으로 캡슐화됩니다.
    - 프레임은 대상 MAC 주소, 소스 MAC 주소, Payload (패킷), 기타 정보로 구성됩니다.
- **스위치의 동작**:
    - 스위치(L2)는 MAC 주소 테이블을 가지고 있어, 이를 기반으로 프레임을 해당 포트로 전달합니다.
    - 모르는 MAC 주소의 경우, 브로드캐스트하여 MAC 주소를 학습합니다.

이 문서는 AWS 환경에서 네트워크가 어떻게 구성되고 작동하는지에 대한 기본적인 이해를 돕기 위한 필수 지식을 제공합니다.